<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flatspell Community App</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
</head>
<body>
    <div id="map" style="width: 100%; height: 100vh;"></div>

    <script>
        // Initialize the map
        var map = L.map('map').setView([48.1181, -123.4307], 13);

        // Set the map provider and attribution
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Function to create a marker with a popup
        function createMarker(lat, lng, name) {
            var marker = L.marker([lat, lng]).addTo(map);
            marker.bindPopup(`<b>${name}</b><br>Click for more info.`);
        }

        function fetchBusinesses() {
            // Define the bounding box for Port Angeles, WA
            var south = 48.1000,
                west = -123.5000,
                north = 48.1300,
                east = -123.4100;

            // Overpass API URL
            var overpassUrl = `https://overpass-api.de/api/interpreter?data=[out:json];(node["amenity"="restaurant"](${south},${west},${north},${east}););out;`;

            // Fetch data from the Overpass API
            fetch(overpassUrl)
                .then((response) => response.json())
                .then((data) => {
                    data.elements.forEach((element) => {
                        if (element.lat && element.lon) {
                            // Create a marker for each business
                            createMarker(element.lat, element.lon, element.tags.name || 'Unknown');
                        }
                    });
                })
                .catch((error) => {
                    console.error("Error fetching data from Overpass API:", error);
                });
        }

        // Fetch businesses from the Overpass API
        fetchBusinesses();

        function fetchCensusData() {
          fetch('/census_data')
            .then((response) => response.json())
            .then((data) => {
                // Update the pane or container with the new data
            })
            .catch((error) => {
                console.error("Error fetching Census data:", error);
        });
}

    </script>
</body>
</html>
